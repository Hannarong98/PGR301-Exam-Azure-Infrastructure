language: generic
env:
  global:
  - tf_version=0.13.5
  - secure: V5VAyHCVYDtxKRC3+SARBmMnckpf3jb1IB8NYUqlJTaFurk18YF4/lVg08Myi5m6EpcwURch3RQUX5g+EF829iV0/XRE0RNSwTiNxCP5AwgLBu+01MFfvoikZG28Tm0eXpIQhx8IsG9YV7nYttCMPnOInc1juyig/1ca7VvqilmrQjUdVgIxyHirVRagBwqZCY9T07ILChy7Ur1i5ZY9Z8pf6YqQQgSbM0rzkNAeN4r/USBSkKAfHdMvbl0mK2yc/w5AsebxAykCCJlep0CzQl+BR/1fMR74bjStg8oDadN1Pg7RhopJu0Fv4qBT8g/OhOPd13P4J0RxoDQfuAPaTnmcECDXWCAgEKI6gT9rhtEoudzg0Toww29l7jA/ms99fcirLxn5qVKWAKi9XsLq4+93ZpqfCAgKSxgzrMxbcRLRaCNL3NhlsUzuTOuIsCdbByCdpcaWYbalGsfIRMfAqLzaKqY06hFlDHzWi02jUTweoCGT78gPcgZUdf5abNC0Bb6xybYHL4pIhcNsBKLArn6rDQ3LgSsDlgLRXgFqZUM2gLbe/Mr2fYB0myl6Ryt0qbdMY+VX8uOPycaJ9bBmPtYkjhHBfRnu0v9JhHdY1LZF7b/aQAsyxqSxWxM1cTRxZxIte3bJh2x3hmJDTVMK51Y85i28v430jQqjLdfH6Pk=
  - secure: DPTHezsH7dEHp4HFOwLPQynBJ/hV17Zey4XXlSTQMilXB62pBqYNzckgZzTmOvZsusmPnRVL6GADs3AEyKSg+vK5KEy5m7RYbkEr7+h9KYSzJfeDM5r55uZhXqlwsJoY1L2jhSIP7pts7HjWWr8mnGteRAxbXRIxPYtN7Y7Mdnxgsu7/pEskSuAbvLHfSlR8rO6cdGGoPCyebHy92Y6IK/vfV6GQHzQhtj4TBy7heiA9WylgOm2DFlc5Y/xmktJxlKb5YhzXE3rLBpCthLF/NESHk/LGXw0PODR/lKHhrdQhZESqzK+iCgKo1mdZ9ahcbnqUi/4drwBU8KrFjrT5XIA2+W0iOrBtkE0m3nBBtjY6EOx6zTOOH8S0IkHFsHwn30dUgo0HIULMhDf28Ib13Rov8EpuoZf866HB+3p5O7r1QmmwddMkwwXK6qa2Qb7RREFO8jth9L/QfyiPvXQlBHQ1sA3KwanrKa8hnrOyOT/kRAHOCZ/DyoDXjvd9XtmbDMQ4cAe754c5Vqhs8LCmf33uhTqI+Zuf/5C9zl1Mzhp8dwWFsToPsJFjyAlJDBo1oxReqHvFeR8HYdXmHi+uB6N0aXaicTg2VY3rYu2j5IUIPwj0EBckd8/rKFfDJV9SEOs8AhzdavYECUuOvbenYw4x3Js10wM1Meh3qRQfZt4=
  - secure: hqQhAyinCkXE56iq941DKl5XZRHc3fLbvx5f8e84rxgC+ButIO9mYJGnIxa50voaIfRVN6WYI8Y1+pyfTAoKjj/pkDqC7R8pLyBPR8BpxvKmknoqY8+uXYYYuX6cyNXyU2hpnsSQDJYN+wov2LihHKi34JiCZOoZXUTefyW9wgCP0P0LvROQlQHNBKqvtZqpr5NGQOt6nkbmzFoqQx+S2BbW1nGdTSL7/5+5S29WhFyKIU6pi4cYqQWKLSGs098JlBBijucYh/AojxVdFD3M+NN/+aWfobPsljzap4+Ya8xWVc3JiflUaPSFghpjLZ8ljLW0gBrFBnFSSJSaOZQ3SoaHe1yWWHnbjTk+DFuVYHSm1+4/P3se7EDlqTaSy+DWqv9fpBfbCkerFFSQdGvEA88Efu1Yfo0ZlxktMBiiicErHI6Kp1W56gExuLWoyKrkFPo2HdbNfiYfnAHx4efEJyj50AtRY0bvB6sSKEGFamwtlKpVgqBbunD1Af3bHajqflJ83m8q9T3GueEaF8+zxfElK8lzoNy3dtKzzX/EAd9iu2Iv89C24r2hCRu0mvPhpt4IwPpoW7gaHjZ/ZbYsQUkdpGCUaAHmepXeNRRxrJJdO4ZmKWwPaQhTgDOgzXftUiD+o5OLf0qeJR4LIpv0ueCmWMEtbzxmu1AHzUIty8w=
  - secure: OwORsjGkFnfR4px9FfK6X0bQj/TDUw80kGO1WSAvY66QhNmRPobms7E6Hkohu0qY5pXjsfzF58YEjZvKohJ7BirERSgdTMgBcwnbt7y5ARKUQkOMByoJTzIIsk2AZG18ZIk00DnqMoJ9EkyEX5PmNxMKhRIGxmly0nHOPai0+oVHOnGSkWQmRxBncs03LFdO/krONHgRsBRNznZXeNdhIjiiMo7Mnx0TBaAJXSheIB7G6M2GKgGo89YzaqQM8YMGP5AO9QPUSTROLoa9NokppTxloH92LlXWu3bdYY9rxRgMuderan1cw8ObohlpvD/pHJK21mRhlXKNJ0jCCCihCnhstFWxRK64l5HpR9PYr2hFKaFEk3atbuOQ6iM5pk2jVQqmh1DcDM8eZu7QMFwZb3pRSGO8E7AfIyuKDtHyNaHXMPjl4Er1CyB5qxamvN3jx75XaqB8qUyxMV3lqh+jbKxlUDl7jeCB4lme+HpCrVO5+OP/wHhyExIjyOzs+acrGgkGpbnBkafjnhbYY1GGpqL/60mt88wjG1aFng8J/1+Zk0nzlfFPeJnnC/SBljDhZCC43A1CnxOpukqwp0hVa97yTZ+kpihEKoGfLMSKtlih0Rx4pj4wFgwTO/OikfqxAtd7lWFDfuBRy3dZA6b22x8hVepEgV+4tbXBsl2mjdE=
  - secure: DfO5F7a4JthVBR/QXeMzwM2/czDaczWn43nwIIAyUw77hKotavLBp59dtmsyACW4i+HnqcQI06FNARCyvYrI4WNPzKAKsO5qVkIHQ1/TXeTXHmxIEqdax9ZeQUbGchhcMH/Fo/fPQHdpfrBpD1LMWDVRjBPbDjK4ypbBdopj2XQ2/63jh+uaAY7RRiGAa8j/8kbjqLC5nfKA1PxCnVA2xtovNJ41Ut36KAJAvw57e4EYvn5S9o4m6uO9wglkxd9krI139l2UzY1B/n/iuvrcci4z4J++q1Ms+v8p7t8IjzzHoXg3AfsHzhaQDOJlU+zoGJpA+Yg2b/U9UlKkyhxyTZb3WDpJPD3nulpGN4C4cCb3jxoxPa8L7xxNSTbDR/yDJbFM6otRj2KMFkabkXWAN49yHbdBIpAncvlL6VU+jyO4EmOYH7uMMoB0wPGkYQYhLp1CPj9n5CwsmGBbOsA2tJOyLbMWe3T0axvhCGvserzetoYj7OVNslDHKcNizknGO4AM2aIfBu2q5b44nphtrPF413r9IADcntqJdA68s49SK6kdn9gXXnaL02YhjZPTFreG29Skenohi4U2rpb1tYtZwfmI91IBpzt1EL9OlEyoYyZpelcmS5rBh5ZhvKywE3E5tYUhJeQcBthJ+vHU0ICr7y3nutxw6WvETj4bfIs=
  - secure: DLlFq87ca9GZwSJEgtEAeJ/UJB3TaQFPwYbX1ClAtJs2Faw5mIF7dkqdpN1lnCtSc53G8aYoZx61xnP7gqPQ32x/i6vc+jWhcTCuaMQKsvkcJ451+H5M/UsAH0dyz351Dw4swB/Gk9rh8dXTM49qsTzPyUbxbFdmAo6SURnHMZorH/mEEr3rn1AEIaUcpApuhklhbGFkOCOw4w8oA1mda9lRg61eQlTYdV74tahgEhg4dt7R3vrtTZ4Xd0SGRa/hjSTtWN9YEI3IEvsMMBFlDwF+q9x72BzXPxxqOzEzvHBoyQts8GVkrr2K91oyGCiIFb3XTtmQRkpf0wdZwlDnxa9YonDRtJW2142XqxN+vTBW8qAKC+/AvbUJTV35cAgP/WOgwyvERuChsuR9JhLH+VUdcFS/j55uyRwnBJxys+ScIgiODp8pYp+VO5s5jdapXxQymzij5Py/uI7o3T78yA8cmm21bY0kFiD/xZ5GErX/Qar4Idr8PenFklczWt90nFJUukqDNPEEAMq52OP/QfIxVZXpUSCaLNtK5/d5BB8CWMsJdYj77k91i96pr0/91IWziMPwTkGOEkt5XlMygS4UTCpawL/4ZZ/EQFs69hlDsX+3facaaHsxQMyJEjLuQ50oZYH47GfVO+6Wrx7l8rp2iUaeAEXrO4abiqsA3EU=
  - secure: TF8q3e/eW5eqgY60IekhbYS0aws9WL8tib6uH0+9BdMsqdAZDi5JmAvuypj/v5zRaU6Jqd3qBASCR6667YSMFTJkQxfREwJFiFqKQhx5eq4++HL7rdjKVheldLfKWwAl7VtyIL6eJ9roO+3cv3i5K5IE7/ZRwQi78g8eHM202RLqKIxu9QoeAcOpWjSmxTY56fZkhD2helt+jLmUCMaAZ2ScJM1uMqXjyPiGIDItH8dyqVfBiDakBspIBBvnTrhJtl36qRleFXWCCen/5eIuQvipZqdtRezXhlVtWAroWjcDnWMk+Vtw4m75Bx1/ykK+TZnk4mk+m3qic8GqknRfLwcuF/YI1JLhmyRkR1Mbz80aM4OAwPXYokA8in2EUo5kyzww6/iIGkTNPhxRFEFEXNR/tyUWf1Ys1Cf6jPkbZt96iYFYDa7gTcbX7//UNBn2GJzvhIObAhxOYoKEGRTTMdvmgsc4/wo+/pB52UMQG9T01TiIUp6wGF4RSXU4fJipx81DU1Pfhc9k5NFXew2fYlIwdPqqrJ/IoXmENLMLiqxEIIR/VjnJI1nS/jjXaQpBZKsw0cH8qZvmicXasoQM4QCr5WUtrRfN+OFfz81M1f1iIW3+taXI05t0zD+oMXNq0hxfccfFxKoHY9jY1qV7GW+GW7ZXsxiLrN76dA+/i84=
  - secure: YaBK2Fxd5PIMSFif1JwAzwzq51IVktAbtleEmtp6MUgZ1rgzVPYPYFxLzU58NeeBmGHdb4179IML+90orGoUaVJKOk3ubYGyyc7yWVNMvsfylitTCpIPg7N4Cos2RqbW7xBTG4yaqwpVrI/4/gNX6N6Cy6dSRqE+PSzlgNGW+ajeu1jHrPCztmIMZWDDz//bUf4P/XF7ioJ+wQcHlxaNqymiF4mUUuU76IUIzubvtdQ0gMsQuU6XroGCIOB5/v3/nd0Qglf9A6eX0DWQU2UEWjc8Vbr52BBEHmJv+G/xZ+ZEFfonAj8YC5D6/VLfthY/2J/weWvV1CdoT1AFEg4EkF/0pW6YKh18FnDTp8esOqOtyNgP+i+G2MS4lRXyRsGnUjWwIRP6wLleL3u0XCs7UpPWYLBar/7o/zLK0b7p0pPfeYm846IhAZRG+kn3AA05A2PSSX6nHe/l2zmGQjtcwMkZsmr0L0RlSTjv1o3b02fO7b3ggZE11g61VKEGaL5kTmQqZ+joNzhotuzyt86I9r4sFo61eEh6EVFgzmgUOmUqliojyyqCqupgmROfwSUwdte5i0NqLAWdX89ejRmM0FI0o73uR4nzxgzwZIyPM3+Zhwk0lPUyPQE5gkBYMIvXGvWQGnZsblckNJiz43D/VOv2fZMAcPpWFZlFS0gafnk=
  - secure: WkWmIYp3zQLKrD2APOz2KkKyilb4XUrVJIdQY6ICCNZBrTDsx4oK1Jqg8IQQKpq/YW6ksTk9wigfh2A+OLU3ogs14Ul/C7qxydJ6q0RFG42xddU7i+kV9EsT7uiKeZfcrECq81iY87ukvni6t/54lCmYg+L2HT/wQT3ajS4wwvSbIKOOwo53Q4cRRgQKwwAPMpneFz8EV7AyAlccsIxQaaTKDtZfg4cZ3HXw7RDcOw5TyLJ0wNzWapXooiCzcRjWemo7bcMoB9WUCCXDdwkhpKkIKd6u+B7YXlCyWUUv4CL3T9jRzxEvGwG5sYg8YUg3BIdIId8+dlUiixdf/NilEjEIn3VnJiPGZI7XRJvf9lG7eqxYFY/H5CUfwMAuaGKHCxmUMGQDYuNufVNaDNQ078xUz/XD4BBZeIU3XbLHirWicv12G6HFn9EcUAbv3kyQ6tQR/DHbAQqlBYBcc0Y/X3u1yo78oV6yBuEFGsDL1lkWg06paeJXIrB2FU0g38OK0g4DrEYar2/jRaSsj31MkMLr9boHeCn4oJOBIrAS9TW+EqsyZwJIR1Tz71ek8c/8fKkypidk5/hintxvsjdPNH1Aso1+T4gclCGQBPp2i7Ukv1v+619svZX6cxh+aHJN+VAKEM53UEqxmydO9HbPDYnJuik4Jhebp8ICXPNyqrk=
before_install:
- wget https://releases.hashicorp.com/terraform/"$tf_version"/terraform_"$tf_version"_linux_amd64.zip
- unzip terraform_"$tf_version"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$tf_version"_linux_amd64.zip
- AZ_REPO=$(lsb_release -cs) && echo "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/
  $AZ_REPO main" | sudo tee /etc/apt/sources.list.d/azure-cli.list
- curl -L https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
- sudo apt-get install apt-transport-https
- sudo apt-get update && sudo apt-get install azure-cli
branches:
  only:
  - master
install: true
script:
- |-
  set -ex;
  export TF_VAR_logz_token=$LOGZ_TOKEN
  export TF_VAR_logz_url=$LOGZ_URL
  export TF_VAR_status_cake_username=$STATUS_CAKE_USERNAME
  export TF_VAR_status_cake_api_key=$STATUS_CAKE_API_KEY
  export ARM_CLIENT_ID=$AZ_CLIENT_ID
  export ARM_CLIENT_SECRET=$AZ_CLIENT_SECRET
  export ARM_SUBSCRIPTION_ID=$AZ_SUB_ID
  export ARM_TENANT_ID=$AZ_TENANT_ID
  export TF_VAR_az_container_registry_url=$AZ_ACR_URL
  export TF_VAR_az_subscription_id=$AZ_SUB_ID
  export TF_VAR_az_client_id=$AZ_CLIENT_ID
  export TF_VAR_az_client_secret=$AZ_CLIENT_SECRET
  export TF_VAR_az_tenant_id=$AZ_TENANT_ID
  terraform init
  terraform import azurerm_resource_group.rg /subscriptions/"${AZ_SUB_ID}"/resourceGroups/pgr301-exam-rg
  terraform plan
  terraform apply --auto-approve
  terraform output
